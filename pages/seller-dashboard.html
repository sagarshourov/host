<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Dashboard - You're Home</title>
    <!-- Fixed CSS imports to match other pages -->
    <link rel="stylesheet" href="../css/base/variables.css">
    <link rel="stylesheet" href="../css/base/typography.css">
    <link rel="stylesheet" href="../css/components/buttons.css">
    <link rel="stylesheet" href="../css/layout/header.css">
    <link rel="stylesheet" href="../css/main.css">
    
    <!-- Dashboard specific styles -->
    <style>
        .main-content {
            padding-top: 80px;
            min-height: calc(100vh - 80px);
            background: #f9f9fb;
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-primary);
        }
        
        .dashboard-actions {
            display: flex;
            gap: 1rem;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--color-gray-600);
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-primary);
        }
        
        /* Listings Section */
        .listings-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-gray-900);
        }
        
        /* Listings Table */
        .listings-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .listings-table th {
            text-align: left;
            padding: 1rem;
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
            color: var(--color-gray-700);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .listings-table td {
            padding: 1rem;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .listing-row {
            transition: background-color 0.2s;
        }
        
        .listing-row:hover {
            background-color: #f8fafc;
        }
        
        .listing-address {
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: 0.25rem;
        }
        
        .listing-details {
            font-size: 0.875rem;
            color: var(--color-gray-600);
        }
        
        .listing-price {
            font-weight: 600;
            color: var(--color-success);
        }
        
        .listing-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-sold {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .offers-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--color-primary);
            color: white;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .listing-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-action {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-action:hover {
            background: #f8fafc;
            border-color: var(--color-primary);
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--color-gray-600);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-gray-800);
        }
    </style>
</head>
<body>
    <!-- Header with dynamic navigation -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                üè† <a href="/" style="text-decoration: none; color: inherit;">You're Home</a>
                <div class="tagline">The Future of Real Estate</div>
            </div>
            <nav class="nav-links" id="mainNav">
                <a href="/listings.html" class="nav-link">Buy</a>
                <a href="/sell.html" class="nav-link">Sell</a>
                <a href="#" class="nav-link">About</a>
                <a href="#" class="nav-link">Help</a>
                <!-- User menu will be inserted here by JavaScript -->
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="dashboard-container">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <h1 class="dashboard-title">Seller Dashboard</h1>
                <div class="dashboard-actions">
                    <a href="/list-property.html" class="btn-primary">
                        + List New Property
                    </a>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Active Listings</div>
                    <div class="stat-value" id="activeListings">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Offers</div>
                    <div class="stat-value" id="totalOffers">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Properties Sold</div>
                    <div class="stat-value" id="propertiesSold">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Days on Market</div>
                    <div class="stat-value" id="avgDaysOnMarket">--</div>
                </div>
            </div>
            
            <!-- Listings Section -->
            <div class="listings-section">
                <div class="section-header">
                    <h2 class="section-title">Your Listings</h2>
                </div>
                
                <div id="listingsContent">
                    <!-- This will be populated by JavaScript -->
                    <div class="empty-state">
                        <div class="empty-state-icon">üè†</div>
                        <div class="empty-state-title">No listings yet</div>
                        <p>List your first property to start receiving offers</p>
                        <a href="/list-property.html" class="btn-primary" style="margin-top: 1rem; display: inline-block;">
                            List Your First Property
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Mock data for demonstration - replace with real API calls
        const mockListings = [
            {
                id: 1,
                address: '123 Ocean View Drive',
                city: 'Atlantic City, NJ 08401',
                bedrooms: 3,
                bathrooms: 2,
                sqft: 1850,
                price: 475000,
                status: 'active',
                offers: 5,
                daysOnMarket: 12
            },
            {
                id: 2,
                address: '456 Beach Boulevard',
                city: 'Ventnor City, NJ 08406',
                bedrooms: 4,
                bathrooms: 3,
                sqft: 2400,
                price: 625000,
                status: 'pending',
                offers: 8,
                daysOnMarket: 8
            }
        ];
        
        // Load dashboard data
        async function loadDashboard() {
            try {
                // Check authentication first
                const authResponse = await fetch('/api/auth/verify', {
                    credentials: 'include'
                });
                
                if (!authResponse.ok) {
                    window.location.href = '/login.html';
                    return;
                }
                
                const authResult = await authResponse.json();
                
                // Update navigation with user info
                updateNavigation(authResult.user);
                
                // Load listings (using mock data for now)
                displayListings(mockListings);
                updateStats(mockListings);
                
            } catch (error) {
                console.error('Dashboard load error:', error);
            }
        }
        
        // Update navigation for logged-in user
        function updateNavigation(user) {
            const nav = document.getElementById('mainNav');
            
            // Create user menu
            const userMenuHTML = `
                <div class="user-menu" style="position: relative; display: inline-block;">
                    <button class="nav-link" style="border: none; background: none; cursor: pointer;" onclick="toggleUserMenu()">
                        Hi, ${user.firstName} ‚ñº
                    </button>
                    <div id="userDropdown" style="display: none; position: absolute; right: 0; top: 100%; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000;">
                        <a href="/seller-dashboard.html" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; hover: background: #f8fafc;">Dashboard</a>
                        <a href="/my-offers.html" style="display: block; padding: 12px 20px; color: #333; text-decoration: none;">My Offers</a>
                        <a href="/profile.html" style="display: block; padding: 12px 20px; color: #333; text-decoration: none;">Profile</a>
                        <hr style="margin: 0; border: none; border-top: 1px solid #e2e8f0;">
                        <a href="#" onclick="logout()" style="display: block; padding: 12px 20px; color: #dc3545; text-decoration: none;">Log Out</a>
                    </div>
                </div>
                <a href="/list-property.html" class="btn-primary">List Your Property</a>
            `;
            
            // Replace login link with user menu
            nav.innerHTML = `
                <a href="/listings.html" class="nav-link">Buy</a>
                <a href="/sell.html" class="nav-link">Sell</a>
                <a href="#" class="nav-link">About</a>
                <a href="#" class="nav-link">Help</a>
                ${userMenuHTML}
            `;
        }
        
        // Toggle user dropdown menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            
            // Close on click outside
            document.addEventListener('click', function closeMenu(e) {
                if (!e.target.closest('.user-menu')) {
                    dropdown.style.display = 'none';
                    document.removeEventListener('click', closeMenu);
                }
            });
        }
        
        // Display listings in table format
        function displayListings(listings) {
            const container = document.getElementById('listingsContent');
            
            if (listings.length === 0) {
                return; // Keep empty state
            }
            
            const tableHTML = `
                <table class="listings-table">
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Offers</th>
                            <th>Days on Market</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${listings.map(listing => `
                            <tr class="listing-row">
                                <td>
                                    <div class="listing-address">${listing.street_address}</div>
                                    <div class="listing-details">${listing.city} ‚Ä¢ ${listing.bedrooms} beds ‚Ä¢ ${listing.bathrooms} baths ‚Ä¢ ${listing.sqft.toLocaleString()} sqft</div>
                                </td>
                                <td>
                                    <div class="listing-price">$${listing.price.toLocaleString()}</div>
                                </td>
                                <td>
                                    <span class="listing-status status-${listing.status}">
                                        ${listing.status.charAt(0).toUpperCase() + listing.status.slice(1)}
                                    </span>
                                </td>
                                <td>
                                    <span class="offers-badge">${listing.offers} offers</span>
                                </td>
                                <td>${listing.daysOnMarket} days</td>
                                <td>
                                    <div class="listing-actions">
                                        <button class="btn-action" onclick="viewOffers(${listing.id})">View Offers</button>
                                        <button class="btn-action" onclick="editListing(${listing.id})">Edit</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }
        
        // Update statistics
        function updateStats(listings) {
            document.getElementById('activeListings').textContent = 
                listings.filter(l => l.status === 'active').length;
            
            document.getElementById('totalOffers').textContent = 
                listings.reduce((sum, l) => sum + l.offers, 0);
            
            document.getElementById('propertiesSold').textContent = 
                listings.filter(l => l.status === 'sold').length;
            
            const avgDays = listings.length > 0 
                ? Math.round(listings.reduce((sum, l) => sum + l.daysOnMarket, 0) / listings.length)
                : '--';
            document.getElementById('avgDaysOnMarket').textContent = avgDays;
        }
        
        // Action handlers
        function viewOffers(listingId) {
            window.location.href = `/offers.html?listing=${listingId}`;
        }
        
        function editListing(listingId) {
            window.location.href = `/edit-property.html?id=${listingId}`;
        }
        
        async function logout() {
            try {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                window.location.href = '/';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/';
            }
        }
        
        // Initialize dashboard on load
        document.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
    
    <!-- Include the API utility -->
    <script src="/js/utils/api.js"></script>
    <script src="/js/utils/navigation-fix.js"></script>
</body>
</html>